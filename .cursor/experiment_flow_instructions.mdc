---
description: "Kaggle Experiment Flow Instructions for AI Agents"
globs: ["**/*.py", "**/*.ipynb", "**/*.md", "**/*.csv", "**/*.json"]
alwaysApply: true
priority: high
team: "kaggle"
version: "1.0"
project: "house_prices"
type: "experiment_flow"
---

# 🤖 Experiment Flow Instructions for AI Agents

## 基本原則

### 役割の明確な分離
- 各エージェントは自分の専門領域に集中
- 他のエージェントの領域に侵入しない
- 役割に関する疑問が生じた場合、`kaggle_team.mdc`を参照

### 品質保証
- 各ステップで品質チェックポイントを必ず実行
- エラー発生時は適切なエスカレーション手順に従う
- 次のエージェントが受け取りやすい形式で出力する

### 情報の流れ
```
User → Document Manager → Planner → User → Developer → Validator → Document Manager → Version Controller
```

---

## 🔄 Experiment実行フロー

### Step 1: アイディア受領・情報収集
**担当**: Document Manager

**入力**:
- ユーザーのアイディア・フィードバック
- 関連ドキュメント・リソース

**処理**:
1. アイディアの整理・要約
2. 関連情報の収集・整理
3. 前回のexperiment結果の確認（該当する場合）

**出力**:
- 整理されたアイディア
- 関連情報の要約
- コンテキスト情報

**品質チェック**:
- [ ] アイディアの意図が明確
- [ ] 関連情報が適切に収集されている
- [ ] 前回の結果との関連性が明確

### Step 2: 計画立案
**担当**: Planner

**入力**:
- Document Managerからの整理されたアイディア
- 関連情報の要約

**処理**:
1. 実装の目的と仮説を明確化
2. 具体的な実装手順を立案
3. 期待される成果を定量化
4. リスク要因と対策を特定

**出力**:
```
[Plan:]
- 実装の目的と仮説
- 具体的な実装手順
- 期待される成果
- リスク要因と対策

[Action:]
- 次のエージェントへの指示
- 必要なリソースの要求
```

**品質チェック**:
- [ ] 実装可能性の確認
- [ ] リソース要件の明確化
- [ ] 期待成果の定量化
- [ ] リスク要因の特定

### Step 3: 計画承認
**担当**: ユーザー

**処理**:
- Plannerの計画をレビュー
- 承認または差し戻しの判断

**承認条件**:
- 実装可能性が確認できる
- 期待成果が明確
- リスクが適切に評価されている

### Step 4: 実装・実行
**担当**: Developer

**入力**:
- 承認された計画

**処理**:
1. `experimentN/`ディレクトリの作成
2. コードの実装・実行
3. 結果ファイルの生成

**ディレクトリ構造**:
```
experimentN/
├── model.py          # モデル実装
├── train.py          # 訓練スクリプト
├── predict.py        # 推論スクリプト
├── results/          # 結果ファイル
│   ├── predictions.csv
│   ├── metrics.json
│   └── plots/
└── README.md         # 実験概要
```

**出力**:
- Pythonコードブロック
- `[Result:]` 実行結果要約

**品質チェック**:
- [ ] コードが正常に実行される
- [ ] 結果ファイルが適切に生成される
- [ ] エラーが発生していない

### Step 5: 結果評価
**担当**: Validator

**入力**:
- Developerの実装結果

**処理**:
1. モデル性能の客観的評価
2. 評価指標の計算
3. 結果の解釈と分析

**評価項目**:
- RMSE（Root Mean Square Error）
- クロスバリデーション結果
- 特徴量重要度
- 予測分布の分析

**出力**:
- 評価用コードブロック
- 評価結果
- `Next Insight` 改善示唆

**品質チェック**:
- [ ] 評価指標が適切に計算されている
- [ ] 結果の解釈が客観的
- [ ] 改善点が明確に示されている

### Step 6: ドキュメント化
**担当**: Document Manager

**入力**:
- 実験結果
- 評価結果

**処理**:
1. 実験概要の文書化
2. 結果の要約
3. 学んだことの記録

**出力**:
- Markdownレポート
- 実験概要
- 結果サマリー

**品質チェック**:
- [ ] 実験の目的が明確に記録されている
- [ ] 結果が適切に要約されている
- [ ] 学んだことが記録されている

### Step 7: バージョン管理
**担当**: Version Controller

**入力**:
- 全ファイル（コード、結果、ドキュメント）

**処理**:
1. 変更の記録
2. 適切なコミットメッセージの生成
3. Gitコミットの実行

**コミットメッセージ例**:
```
feat(experiment): カテゴリカル変数の特徴量エンジニアリングを追加

- カテゴリカル特徴量のターゲットエンコーディングを実装
- 数値変数の多項式特徴量を追加
- RMSEが0.15から0.12に改善
- クロスバリデーションスコア: 0.118 ± 0.008
```

**出力**:
- Gitコマンド
- コミットメッセージ

**品質チェック**:
- [ ] コミットメッセージが適切
- [ ] 必要なファイルがすべて含まれている
- [ ] 実験の内容が明確に記録されている

---

## 🚨 エラーハンドリング

### 各ステップでの失敗時の対応

#### Document Manager
- 情報収集に失敗した場合
  - ユーザーに追加情報を要求
  - 利用可能な情報で可能な限り進める

#### Planner
- 計画立案に失敗した場合
  - より詳細な情報をDocument Managerに要求
  - 段階的な計画に分割

#### Developer
- コード実行に失敗した場合
  - エラーメッセージを詳細に記録
  - 代替手法をPlannerに提案

#### Validator
- 評価に失敗した場合
  - 基本的な評価指標から開始
  - 段階的に詳細な評価を追加
１
#### Document Manager
- 文書化に失敗した場合
  - 最低限の情報から開始
  - 段階的に詳細を追加

#### Version Controller
- コミットに失敗した場合
  - エラーの原因を特定
  - 適切な修正を実行

### エスカレーション手順

1. **レベル1**: 同じエージェント内で再試行
2. **レベル2**: 前のステップのエージェントに相談
3. **レベル3**: ユーザーに報告・相談

---

## 📊 品質チェックポイント

### 各ステップ完了時の確認事項

#### 全エージェント共通
- [ ] 入力が適切に処理されている
- [ ] 出力が次のエージェントに適している
- [ ] エラーが発生していない
- [ ] ログが適切に記録されている

#### ステップ別確認事項

**Step 1 (Document Manager)**
- [ ] アイディアの意図が明確
- [ ] 関連情報が適切に収集されている
- [ ] 前回の結果との関連性が明確

**Step 2 (Planner)**
- [ ] 実装可能性が確認できる
- [ ] 期待成果が定量化されている
- [ ] リスクが適切に評価されている

**Step 4 (Developer)**
- [ ] コードが正常に実行される
- [ ] 結果ファイルが適切に生成される
- [ ] エラーが発生していない

**Step 5 (Validator)**
- [ ] 評価指標が適切に計算されている
- [ ] 結果の解釈が客観的
- [ ] 改善点が明確に示されている

**Step 6 (Document Manager)**
- [ ] 実験の目的が明確に記録されている
- [ ] 結果が適切に要約されている
- [ ] 学んだことが記録されている

**Step 7 (Version Controller)**
- [ ] コミットメッセージが適切
- [ ] 必要なファイルがすべて含まれている
- [ ] 実験の内容が明確に記録されている

---

## 🔄 次のステップへの引き継ぎ

### 各エージェントから次のエージェントへの引き継ぎ方法

#### Document Manager → Planner
- 整理されたアイディア
- 関連情報の要約
- 前回の結果（該当する場合）

#### Planner → Developer
- 承認された計画
- 実装手順の詳細
- 期待される成果

#### Developer → Validator
- 実装されたコード
- 生成された結果ファイル
- 実行ログ

#### Validator → Document Manager
- 評価結果
- 改善点の提案
- 次のexperimentへの示唆

#### Document Manager → Version Controller
- 文書化された結果
- 実験概要
- 関連ファイル

---

## 📚 参考情報

### 関連ドキュメント
- **基本ルール（チーム憲法）**: `.cursor/kaggle_team.mdc`
- **Docs Manager ルール（運用規約 / SSOT）**: `.cursor/docs_manager_rules.mdc`
- **Docs Manager ルール（人間向け入口）**: `docs/docs_manager_rules.md`

### 実験管理
- **命名規則**: `experiment{N}_{description}`
- **ディレクトリ構造**: 標準的な構造に従う
- **結果記録**: JSON形式でメトリクスを管理

### 品質保証
- **チェックリスト**: 各ステップで必ず確認
- **エラーハンドリング**: 段階的な対応
- **エスカレーション**: 適切なレベルでの報告

---

**すべてのエージェントは、experimentを実行する際はこの指示書に従うこと。**